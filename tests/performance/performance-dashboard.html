<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zinses-Rechner Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.1rem;
            color: #64748b;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .metric-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #475569;
            margin-bottom: 1rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .metric-value.good { color: #059669; }
        .metric-value.warning { color: #d97706; }
        .metric-value.critical { color: #dc2626; }
        
        .metric-unit {
            font-size: 1rem;
            color: #64748b;
            font-weight: 400;
        }
        
        .metric-trend {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .trend-up { color: #059669; }
        .trend-down { color: #dc2626; }
        .trend-stable { color: #64748b; }
        
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .chart-container h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 1rem;
        }
        
        .chart-canvas {
            max-height: 300px;
        }
        
        .status-indicators {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .status-indicator.healthy {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-indicator.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-indicator.critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-dot.healthy { background: #22c55e; }
        .status-dot.warning { background: #f59e0b; }
        .status-dot.critical { background: #ef4444; }
        
        .refresh-controls {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .refresh-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .refresh-button:hover {
            background: #2563eb;
        }
        
        .last-updated {
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                padding: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>ğŸš€ Zinses-Rechner Performance Dashboard</h1>
            <p>å®æ—¶æ€§èƒ½ç›‘æ§å’Œè´Ÿè½½æµ‹è¯•ç»“æœ</p>
        </div>

        <div class="refresh-controls">
            <button class="refresh-button" onclick="refreshData()">
                ğŸ”„ åˆ·æ–°æ•°æ®
            </button>
        </div>

        <div class="status-indicators">
            <div class="status-indicator healthy" id="api-status">
                <div class="status-dot healthy"></div>
                <span>APIæœåŠ¡æ­£å¸¸</span>
            </div>
            <div class="status-indicator healthy" id="frontend-status">
                <div class="status-dot healthy"></div>
                <span>å‰ç«¯æœåŠ¡æ­£å¸¸</span>
            </div>
            <div class="status-indicator healthy" id="cache-status">
                <div class="status-dot healthy"></div>
                <span>ç¼“å­˜æ€§èƒ½è‰¯å¥½</span>
            </div>
            <div class="status-indicator healthy" id="database-status">
                <div class="status-dot healthy"></div>
                <span>æ•°æ®åº“è¿æ¥æ­£å¸¸</span>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h3>APIå“åº”æ—¶é—´</h3>
                <div class="metric-value good" id="api-response-time">245</div>
                <span class="metric-unit">ms (P95)</span>
                <div class="metric-trend trend-stable">
                    ğŸ“Š ç›®æ ‡: < 500ms
                </div>
            </div>

            <div class="metric-card">
                <h3>å¹¶å‘å¤„ç†èƒ½åŠ›</h3>
                <div class="metric-value good" id="concurrent-rps">1,247</div>
                <span class="metric-unit">RPS</span>
                <div class="metric-trend trend-up">
                    ğŸ“ˆ ç›®æ ‡: > 1,000 RPS
                </div>
            </div>

            <div class="metric-card">
                <h3>å†…å­˜ä½¿ç”¨ç‡</h3>
                <div class="metric-value good" id="memory-usage">67</div>
                <span class="metric-unit">%</span>
                <div class="metric-trend trend-stable">
                    ğŸ’¾ ç›®æ ‡: < 80%
                </div>
            </div>

            <div class="metric-card">
                <h3>CPUä½¿ç”¨ç‡</h3>
                <div class="metric-value warning" id="cpu-usage">72</div>
                <span class="metric-unit">%</span>
                <div class="metric-trend trend-up">
                    âš¡ ç›®æ ‡: < 80%
                </div>
            </div>

            <div class="metric-card">
                <h3>ç¼“å­˜å‘½ä¸­ç‡</h3>
                <div class="metric-value good" id="cache-hit-rate">91</div>
                <span class="metric-unit">%</span>
                <div class="metric-trend trend-stable">
                    ğŸ—„ï¸ ç›®æ ‡: > 85%
                </div>
            </div>

            <div class="metric-card">
                <h3>é”™è¯¯ç‡</h3>
                <div class="metric-value good" id="error-rate">0.03</div>
                <span class="metric-unit">%</span>
                <div class="metric-trend trend-down">
                    ğŸ›¡ï¸ ç›®æ ‡: < 1%
                </div>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-container">
                <h3>ğŸ“ˆ APIå“åº”æ—¶é—´è¶‹åŠ¿</h3>
                <canvas id="response-time-chart" class="chart-canvas"></canvas>
            </div>

            <div class="chart-container">
                <h3>ğŸš€ å¹¶å‘è¯·æ±‚å¤„ç†</h3>
                <canvas id="rps-chart" class="chart-canvas"></canvas>
            </div>

            <div class="chart-container">
                <h3>ğŸ’¾ ç³»ç»Ÿèµ„æºä½¿ç”¨</h3>
                <canvas id="resource-chart" class="chart-canvas"></canvas>
            </div>

            <div class="chart-container">
                <h3>ğŸ—„ï¸ ç¼“å­˜æ€§èƒ½åˆ†æ</h3>
                <canvas id="cache-chart" class="chart-canvas"></canvas>
            </div>
        </div>

        <div class="last-updated">
            æœ€åæ›´æ–°: <span id="last-updated-time">--</span>
        </div>
    </div>

    <script>
        // å›¾è¡¨é…ç½®
        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'æ—¶é—´'
                    }
                },
                y: {
                    display: true,
                    beginAtZero: true
                }
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            // APIå“åº”æ—¶é—´å›¾è¡¨
            const responseTimeCtx = document.getElementById('response-time-chart').getContext('2d')
            window.responseTimeChart = new Chart(responseTimeCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'P95å“åº”æ—¶é—´ (ms)',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'ç›®æ ‡çº¿ (500ms)',
                        data: [],
                        borderColor: '#ef4444',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        ...chartConfig.scales,
                        y: {
                            ...chartConfig.scales.y,
                            title: {
                                display: true,
                                text: 'å“åº”æ—¶é—´ (ms)'
                            }
                        }
                    }
                }
            })

            // RPSå›¾è¡¨
            const rpsCtx = document.getElementById('rps-chart').getContext('2d')
            window.rpsChart = new Chart(rpsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'æ¯ç§’è¯·æ±‚æ•°',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'ç›®æ ‡çº¿ (1000 RPS)',
                        data: [],
                        borderColor: '#ef4444',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        ...chartConfig.scales,
                        y: {
                            ...chartConfig.scales.y,
                            title: {
                                display: true,
                                text: 'RPS'
                            }
                        }
                    }
                }
            })

            // èµ„æºä½¿ç”¨å›¾è¡¨
            const resourceCtx = document.getElementById('resource-chart').getContext('2d')
            window.resourceChart = new Chart(resourceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPUä½¿ç”¨ç‡ (%)',
                        data: [],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'å†…å­˜ä½¿ç”¨ç‡ (%)',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        ...chartConfig.scales,
                        y: {
                            ...chartConfig.scales.y,
                            max: 100,
                            title: {
                                display: true,
                                text: 'ä½¿ç”¨ç‡ (%)'
                            }
                        }
                    }
                }
            })

            // ç¼“å­˜æ€§èƒ½å›¾è¡¨
            const cacheCtx = document.getElementById('cache-chart').getContext('2d')
            window.cacheChart = new Chart(cacheCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ç¼“å­˜å‘½ä¸­', 'ç¼“å­˜æœªå‘½ä¸­'],
                    datasets: [{
                        data: [91, 9],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%'
                                }
                            }
                        }
                    }
                }
            })
        }

        // æ›´æ–°æŒ‡æ ‡å€¼
        function updateMetrics(data) {
            // æ›´æ–°APIå“åº”æ—¶é—´
            const apiResponseTime = document.getElementById('api-response-time')
            apiResponseTime.textContent = data.api_response_time || '245'
            apiResponseTime.className = `metric-value ${data.api_response_time < 500 ? 'good' : 'warning'}`

            // æ›´æ–°å¹¶å‘å¤„ç†èƒ½åŠ›
            const concurrentRps = document.getElementById('concurrent-rps')
            concurrentRps.textContent = (data.concurrent_rps || 1247).toLocaleString('de-DE')
            concurrentRps.className = `metric-value ${data.concurrent_rps > 1000 ? 'good' : 'warning'}`

            // æ›´æ–°å†…å­˜ä½¿ç”¨ç‡
            const memoryUsage = document.getElementById('memory-usage')
            memoryUsage.textContent = data.memory_usage || '67'
            memoryUsage.className = `metric-value ${data.memory_usage < 80 ? 'good' : 'warning'}`

            // æ›´æ–°CPUä½¿ç”¨ç‡
            const cpuUsage = document.getElementById('cpu-usage')
            cpuUsage.textContent = data.cpu_usage || '72'
            cpuUsage.className = `metric-value ${data.cpu_usage < 80 ? 'good' : 'warning'}`

            // æ›´æ–°ç¼“å­˜å‘½ä¸­ç‡
            const cacheHitRate = document.getElementById('cache-hit-rate')
            cacheHitRate.textContent = data.cache_hit_rate || '91'
            cacheHitRate.className = `metric-value ${data.cache_hit_rate > 85 ? 'good' : 'warning'}`

            // æ›´æ–°é”™è¯¯ç‡
            const errorRate = document.getElementById('error-rate')
            errorRate.textContent = data.error_rate || '0.03'
            errorRate.className = `metric-value ${data.error_rate < 1 ? 'good' : 'critical'}`

            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            updateStatusIndicators(data)
        }

        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatusIndicators(data) {
            const indicators = {
                'api-status': data.api_response_time < 500,
                'frontend-status': data.frontend_performance > 85,
                'cache-status': data.cache_hit_rate > 85,
                'database-status': data.database_response_time < 100
            }

            Object.entries(indicators).forEach(([id, isHealthy]) => {
                const indicator = document.getElementById(id)
                const dot = indicator.querySelector('.status-dot')
                
                if (isHealthy) {
                    indicator.className = 'status-indicator healthy'
                    dot.className = 'status-dot healthy'
                } else {
                    indicator.className = 'status-indicator warning'
                    dot.className = 'status-dot warning'
                }
            })
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateCharts(timeSeriesData) {
            const now = new Date().toLocaleTimeString('de-DE')
            
            // æ›´æ–°å“åº”æ—¶é—´å›¾è¡¨
            if (window.responseTimeChart) {
                const chart = window.responseTimeChart
                chart.data.labels.push(now)
                chart.data.datasets[0].data.push(timeSeriesData.response_time || Math.random() * 400 + 200)
                chart.data.datasets[1].data.push(500) // ç›®æ ‡çº¿
                
                // ä¿æŒæœ€è¿‘20ä¸ªæ•°æ®ç‚¹
                if (chart.data.labels.length > 20) {
                    chart.data.labels.shift()
                    chart.data.datasets[0].data.shift()
                    chart.data.datasets[1].data.shift()
                }
                
                chart.update('none')
            }

            // æ›´æ–°RPSå›¾è¡¨
            if (window.rpsChart) {
                const chart = window.rpsChart
                chart.data.labels.push(now)
                chart.data.datasets[0].data.push(timeSeriesData.rps || Math.random() * 500 + 800)
                chart.data.datasets[1].data.push(1000) // ç›®æ ‡çº¿
                
                if (chart.data.labels.length > 20) {
                    chart.data.labels.shift()
                    chart.data.datasets[0].data.shift()
                    chart.data.datasets[1].data.shift()
                }
                
                chart.update('none')
            }

            // æ›´æ–°èµ„æºä½¿ç”¨å›¾è¡¨
            if (window.resourceChart) {
                const chart = window.resourceChart
                chart.data.labels.push(now)
                chart.data.datasets[0].data.push(timeSeriesData.cpu_usage || Math.random() * 30 + 50)
                chart.data.datasets[1].data.push(timeSeriesData.memory_usage || Math.random() * 20 + 60)
                
                if (chart.data.labels.length > 20) {
                    chart.data.labels.shift()
                    chart.data.datasets[0].data.shift()
                    chart.data.datasets[1].data.shift()
                }
                
                chart.update('none')
            }

            // æ›´æ–°ç¼“å­˜å›¾è¡¨
            if (window.cacheChart) {
                const hitRate = timeSeriesData.cache_hit_rate || 91
                const missRate = 100 - hitRate
                
                window.cacheChart.data.datasets[0].data = [hitRate, missRate]
                window.cacheChart.update('none')
            }
        }

        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            try {
                // æ¨¡æ‹Ÿæ•°æ®è·å–ï¼ˆå®é™…åº”è¯¥ä»APIè·å–ï¼‰
                const mockData = {
                    api_response_time: Math.random() * 200 + 200,
                    concurrent_rps: Math.random() * 500 + 1000,
                    memory_usage: Math.random() * 30 + 50,
                    cpu_usage: Math.random() * 40 + 40,
                    cache_hit_rate: Math.random() * 15 + 85,
                    error_rate: Math.random() * 0.5,
                    frontend_performance: Math.random() * 20 + 80,
                    database_response_time: Math.random() * 50 + 30
                }

                updateMetrics(mockData)
                updateCharts(mockData)
                
                document.getElementById('last-updated-time').textContent = new Date().toLocaleString('de-DE')
                
            } catch (error) {
                console.error('æ•°æ®åˆ·æ–°å¤±è´¥:', error)
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts()
            refreshData()
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshData, 30000)
        })
    </script>
</body>
</html>
